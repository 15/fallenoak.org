---
import Layout from "../layouts/Layout.astro";
import Splash from "../components/Home/Splash.astro";
import Mission from "../components/Home/Mission.astro";
import Pinned from "../components/Home/Pinned.astro";
import Stats from "../components/Home/Stats.astro";
import News from "../components/Home/News.astro";
import Footer from "../components/Footer.astro";
---

<Layout title="Fallen Oaks Equine Rescue | Home">
  <div class="wrapper overflow-x-hidden">
    <Splash />
    <Mission />
    <Pinned />
    <Stats />
    <News />
    <Footer id="footer" />
  </div>
  
</Layout>

<style></style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import Lenis from "lenis";

  gsap.registerPlugin(ScrollTrigger);
  const lenis = new Lenis({
    content: document.querySelector(".wrapper"),
    duration: 1.2,
    easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
  });

  const raf = (t) => {
    lenis.raf(t);
    lenis.resize();
    ScrollTrigger.update();
    requestAnimationFrame(raf);
  };
  requestAnimationFrame(raf);

  gsap.set(".panel", { zIndex: (i, target, targets) => targets.length - i });

  const images = gsap.utils.toArray(".panel:not(.purple)");

  images.forEach((image, i) => {
    var tl = gsap.timeline({
      scrollTrigger: {
        trigger: "section.black",
        start: () => "top -" + window.innerHeight * (i + 0.5),
        end: () => "+=" + window.innerHeight,
        scrub: true,
        toggleActions: "play none reverse none",
        invalidateOnRefresh: true,
      },
    });

    tl.to(image, { height: 0 });
  });

  gsap.set(".panel-text", {
    zIndex: (i, target, targets) => targets.length - i,
  });

  const texts = gsap.utils.toArray(".panel-text");

  texts.forEach((text, i) => {
    var tl = gsap.timeline({
      scrollTrigger: {
        trigger: "section.black",
        start: () => "top -" + window.innerHeight * i,
        end: () => "+=" + window.innerHeight,
        scrub: true,
        toggleActions: "play none reverse none",
        invalidateOnRefresh: true,
      },
    });

    tl.to(text, { duration: 0.33, opacity: 1, y: "50%" }).to(
      text,
      { duration: 0.33, opacity: 0, y: "0%" },
      0.66
    );
  });

  ScrollTrigger.create({
    trigger: "section.black",
    scrub: true,
    markers: true,
    pin: true,
    start: () => "top top",
    end: () => "+=" + (images.length + 1) * window.innerHeight,
    invalidateOnRefresh: true,
  });
</script>
